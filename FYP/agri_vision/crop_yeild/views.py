import joblib
from django.shortcuts import render
from sklearn.preprocessing import MinMaxScaler, LabelEncoder
from django.http import JsonResponse
import logging
import numpy as np

STATE_MAPPING = {0: 'Andaman and Nicobar Islands', 1: 'Andhra Pradesh', 2: 'Arunachal Pradesh', 3: 'Assam', 4: 'Bihar', 5: 'Chandigarh', 6: 'Chhattisgarh', 7: 'Dadra and Nagar Haveli', 8: 'Goa', 9: 'Gujarat', 10: 'Haryana', 11: 'Himachal Pradesh', 12: 'Jammu and Kashmir ', 13: 'Jharkhand', 14: 'Karnataka', 15: 'Kerala', 16: 'Madhya Pradesh', 17: 'Maharashtra', 18: 'Manipur', 19: 'Meghalaya', 20: 'Mizoram', 21: 'Nagaland', 22: 'Odisha', 23: 'Puducherry', 24: 'Punjab', 25: 'Rajasthan', 26: 'Sikkim', 27: 'Tamil Nadu', 28: 'Telangana ', 29: 'Tripura', 30: 'Uttar Pradesh', 31: 'Uttarakhand', 32: 'West Bengal'}

DISTRICT_MAPPING = {0: '24 PARAGANAS NORTH', 1: '24 PARAGANAS SOUTH', 2: 'ADILABAD', 3: 'AGAR MALWA', 4: 'AGRA', 5: 'AHMADABAD', 6: 'AHMEDNAGAR', 7: 'AIZAWL', 8: 'AJMER', 9: 'AKOLA', 10: 'ALAPPUZHA', 11: 'ALIGARH', 12: 'ALIRAJPUR', 13: 'ALLAHABAD', 14: 'ALMORA', 15: 'ALWAR', 16: 'AMBALA', 17: 'AMBEDKAR NAGAR', 18: 'AMETHI', 19: 'AMRAVATI', 20: 'AMRELI', 21: 'AMRITSAR', 22: 'AMROHA', 23: 'ANAND', 24: 'ANANTAPUR', 25: 'ANANTNAG', 26: 'ANJAW', 27: 'ANUGUL', 28: 'ANUPPUR', 29: 'ARARIA', 30: 'ARIYALUR', 31: 'ARWAL', 32: 'ASHOKNAGAR', 33: 'AURAIYA', 34: 'AURANGABAD', 35: 'AZAMGARH', 36: 'BADGAM', 37: 'BAGALKOT', 38: 'BAGESHWAR', 39: 'BAGHPAT', 40: 'BAHRAICH', 41: 'BAKSA', 42: 'BALAGHAT', 43: 'BALANGIR', 44: 'BALESHWAR', 45: 'BALLIA', 46: 'BALOD', 47: 'BALODA BAZAR', 48: 'BALRAMPUR', 49: 'BANAS KANTHA', 50: 'BANDA', 51: 'BANDIPORA', 52: 'BANGALORE RURAL', 53: 'BANKA', 54: 'BANKURA', 55: 'BANSWARA', 56: 'BARABANKI', 57: 'BARAMULLA', 58: 'BARAN', 59: 'BARDHAMAN', 60: 'BAREILLY', 61: 'BARGARH', 62: 'BARMER', 63: 'BARNALA', 64: 'BARPETA', 65: 'BARWANI', 66: 'BASTAR', 67: 'BASTI', 68: 'BATHINDA', 69: 'BEED', 70: 'BEGUSARAI', 71: 'BELGAUM', 72: 'BELLARY', 73: 'BEMETARA', 74: 'BENGALURU URBAN', 75: 'BETUL', 76: 'BHADRAK', 77: 'BHAGALPUR', 78: 'BHANDARA', 79: 'BHARATPUR', 80: 'BHARUCH', 81: 'BHAVNAGAR', 82: 'BHILWARA', 83: 'BHIND', 84: 'BHIWANI', 85: 'BHOJPUR', 86: 'BHOPAL', 87: 'BIDAR', 88: 'BIJAPUR', 89: 'BIJNOR', 90: 'BIKANER', 91: 'BILASPUR', 92: 'BIRBHUM', 93: 'BISHNUPUR', 94: 'BOKARO', 95: 'BONGAIGAON', 96: 'BOUDH', 97: 'BUDAUN', 98: 'BULANDSHAHR', 99: 'BULDHANA', 100: 'BUNDI', 101: 'BURHANPUR', 102: 'BUXAR', 103: 'CACHAR', 104: 'CHAMARAJANAGAR', 105: 'CHAMBA', 106: 'CHAMOLI', 107: 'CHAMPAWAT', 108: 'CHAMPHAI', 109: 'CHANDAULI', 110: 'CHANDEL', 111: 'CHANDIGARH', 112: 'CHANDRAPUR', 113: 'CHANGLANG', 114: 'CHATRA', 115: 'CHHATARPUR', 116: 'CHHINDWARA', 117: 'CHIKBALLAPUR', 118: 'CHIKMAGALUR', 119: 'CHIRANG', 120: 'CHITRADURGA', 121: 'CHITRAKOOT', 122: 'CHITTOOR', 123: 'CHITTORGARH', 124: 'CHURACHANDPUR', 125: 'CHURU', 126: 'COIMBATORE', 127: 'COOCHBEHAR', 128: 'CUDDALORE', 129: 'CUTTACK', 130: 'DADRA AND NAGAR HAVELI', 131: 'DAKSHIN KANNAD', 132: 'DAMOH', 133: 'DANG', 134: 'DANTEWADA', 135: 'DARBHANGA', 136: 'DARJEELING', 137: 'DARRANG', 138: 'DATIA', 139: 'DAUSA', 140: 'DAVANGERE', 141: 'DEHRADUN', 142: 'DEOGARH', 143: 'DEOGHAR', 144: 'DEORIA', 145: 'DEWAS', 146: 'DHALAI', 147: 'DHAMTARI', 148: 'DHANBAD', 149: 'DHAR', 150: 'DHARMAPURI', 151: 'DHARWAD', 152: 'DHEMAJI', 153: 'DHENKANAL', 154: 'DHOLPUR', 155: 'DHUBRI', 156: 'DHULE', 157: 'DIBANG VALLEY', 158: 'DIBRUGARH', 159: 'DIMA HASAO', 160: 'DIMAPUR', 161: 'DINAJPUR DAKSHIN', 162: 'DINAJPUR UTTAR', 163: 'DINDIGUL', 164: 'DINDORI', 165: 'DODA', 166: 'DOHAD', 167: 'DUMKA', 168: 'DUNGARPUR', 169: 'DURG', 170: 'EAST DISTRICT', 171: 'EAST GARO HILLS', 172: 'EAST GODAVARI', 173: 'EAST JAINTIA HILLS', 174: 'EAST KAMENG', 175: 'EAST KHASI HILLS', 176: 'EAST SIANG', 177: 'EAST SINGHBUM', 178: 'ERNAKULAM', 179: 'ERODE', 180: 'ETAH', 181: 'ETAWAH', 182: 'FAIZABAD', 183: 'FARIDABAD', 184: 'FARIDKOT', 185: 'FARRUKHABAD', 186: 'FATEHABAD', 187: 'FATEHGARH SAHIB', 188: 'FATEHPUR', 189: 'FAZILKA', 190: 'FIROZABAD', 191: 'FIROZEPUR', 192: 'GADAG', 193: 'GADCHIROLI', 194: 'GAJAPATI', 195: 'GANDERBAL', 196: 'GANDHINAGAR', 197: 'GANGANAGAR', 198: 'GANJAM', 199: 'GARHWA', 200: 'GARIYABAND', 201: 'GAUTAM BUDDHA NAGAR', 202: 'GAYA', 203: 'GHAZIABAD', 204: 'GHAZIPUR', 205: 'GIRIDIH', 206: 'GOALPARA', 207: 'GODDA', 208: 'GOLAGHAT', 209: 'GOMATI', 210: 'GONDA', 211: 'GONDIA', 212: 'GOPALGANJ', 213: 'GORAKHPUR', 214: 'GULBARGA', 215: 'GUMLA', 216: 'GUNA', 217: 'GUNTUR', 218: 'GURDASPUR', 219: 'GURGAON', 220: 'GWALIOR', 221: 'HAILAKANDI', 222: 'HAMIRPUR', 223: 'HANUMANGARH', 224: 'HAPUR', 225: 'HARDA', 226: 'HARDOI', 227: 'HARIDWAR', 228: 'HASSAN', 229: 'HATHRAS', 230: 'HAVERI', 231: 'HAZARIBAGH', 232: 'HINGOLI', 233: 'HISAR', 234: 'HOOGHLY', 235: 'HOSHANGABAD', 236: 'HOSHIARPUR', 237: 'HOWRAH', 238: 'HYDERABAD', 239: 'IDUKKI', 240: 'IMPHAL EAST', 241: 'IMPHAL WEST', 242: 'INDORE', 243: 'JABALPUR', 244: 'JAGATSINGHAPUR', 245: 'JAIPUR', 246: 'JAISALMER', 247: 'JAJAPUR', 248: 'JALANDHAR', 249: 'JALAUN', 250: 'JALGAON', 251: 'JALNA', 252: 'JALORE', 253: 'JALPAIGURI', 254: 'JAMMU', 255: 'JAMNAGAR', 256: 'JAMTARA', 257: 'JAMUI', 258: 'JANJGIR-CHAMPA', 259: 'JASHPUR', 260: 'JAUNPUR', 261: 'JEHANABAD', 262: 'JHABUA', 263: 'JHAJJAR', 264: 'JHALAWAR', 265: 'JHANSI', 266: 'JHARSUGUDA', 267: 'JHUNJHUNU', 268: 'JIND', 269: 'JODHPUR', 270: 'JORHAT', 271: 'JUNAGADH', 272: 'KABIRDHAM', 273: 'KACHCHH', 274: 'KADAPA', 275: 'KAIMUR (BHABUA)', 276: 'KAITHAL', 277: 'KALAHANDI', 278: 'KAMRUP', 279: 'KAMRUP METRO', 280: 'KANCHIPURAM', 281: 'KANDHAMAL', 282: 'KANGRA', 283: 'KANKER', 284: 'KANNAUJ', 285: 'KANNIYAKUMARI', 286: 'KANNUR', 287: 'KANPUR DEHAT', 288: 'KANPUR NAGAR', 289: 'KAPURTHALA', 290: 'KARAIKAL', 291: 'KARAULI', 292: 'KARBI ANGLONG', 293: 'KARGIL', 294: 'KARIMGANJ', 295: 'KARIMNAGAR', 296: 'KARNAL', 297: 'KARUR', 298: 'KASARAGOD', 299: 'KASGANJ', 300: 'KATHUA', 301: 'KATIHAR', 302: 'KATNI', 303: 'KAUSHAMBI', 304: 'KENDRAPARA', 305: 'KENDUJHAR', 306: 'KHAGARIA', 307: 'KHAMMAM', 308: 'KHANDWA', 309: 'KHARGONE', 310: 'KHEDA', 311: 'KHERI', 312: 'KHORDHA', 313: 'KHOWAI', 314: 'KHUNTI', 315: 'KINNAUR', 316: 'KIPHIRE', 317: 'KISHANGANJ', 318: 'KISHTWAR', 319: 'KODAGU', 320: 'KODERMA', 321: 'KOHIMA', 322: 'KOKRAJHAR', 323: 'KOLAR', 324: 'KOLASIB', 325: 'KOLHAPUR', 326: 'KOLLAM', 327: 'KONDAGAON', 328: 'KOPPAL', 329: 'KORAPUT', 330: 'KORBA', 331: 'KOREA', 332: 'KOTA', 333: 'KOTTAYAM', 334: 'KOZHIKODE', 335: 'KRISHNA', 336: 'KRISHNAGIRI', 337: 'KULGAM', 338: 'KULLU', 339: 'KUPWARA', 340: 'KURNOOL', 341: 'KURUKSHETRA', 342: 'KURUNG KUMEY', 343: 'KUSHI NAGAR', 344: 'LAHUL AND SPITI', 345: 'LAKHIMPUR', 346: 'LAKHISARAI', 347: 'LALITPUR', 348: 'LATEHAR', 349: 'LATUR', 350: 'LAWNGTLAI', 351: 'LEH LADAKH', 352: 'LOHARDAGA', 353: 'LOHIT', 354: 'LONGDING', 355: 'LONGLENG', 356: 'LOWER DIBANG VALLEY', 357: 'LOWER SUBANSIRI', 358: 'LUCKNOW', 359: 'LUDHIANA', 360: 'LUNGLEI', 361: 'MADHEPURA', 362: 'MADHUBANI', 363: 'MADURAI', 364: 'MAHARAJGANJ', 365: 'MAHASAMUND', 366: 'MAHBUBNAGAR', 367: 'MAHE', 368: 'MAHENDRAGARH', 369: 'MAHESANA', 370: 'MAHOBA', 371: 'MAINPURI', 372: 'MALAPPURAM', 373: 'MALDAH', 374: 'MALKANGIRI', 375: 'MAMIT', 376: 'MANDI', 377: 'MANDLA', 378: 'MANDSAUR', 379: 'MANDYA', 380: 'MANSA', 381: 'MARIGAON', 382: 'MATHURA', 383: 'MAU', 384: 'MAYURBHANJ', 385: 'MEDAK', 386: 'MEDINIPUR EAST', 387: 'MEDINIPUR WEST', 388: 'MEERUT', 389: 'MEWAT', 390: 'MIRZAPUR', 391: 'MOGA', 392: 'MOKOKCHUNG', 393: 'MON', 394: 'MORADABAD', 395: 'MORENA', 396: 'MUKTSAR', 397: 'MUMBAI', 398: 'MUNGELI', 399: 'MUNGER', 400: 'MURSHIDABAD', 401: 'MUZAFFARNAGAR', 402: 'MUZAFFARPUR', 403: 'MYSORE', 404: 'NABARANGPUR', 405: 'NADIA', 406: 'NAGAON', 407: 'NAGAPATTINAM', 408: 'NAGAUR', 409: 'NAGPUR', 410: 'NAINITAL', 411: 'NALANDA', 412: 'NALBARI', 413: 'NALGONDA', 414: 'NAMAKKAL', 415: 'NAMSAI', 416: 'NANDED', 417: 'NANDURBAR', 418: 'NARAYANPUR', 419: 'NARMADA', 420: 'NARSINGHPUR', 421: 'NASHIK', 422: 'NAVSARI', 423: 'NAWADA', 424: 'NAWANSHAHR', 425: 'NAYAGARH', 426: 'NEEMUCH', 427: 'NICOBARS', 428: 'NIZAMABAD', 429: 'NORTH AND MIDDLE ANDAMAN', 430: 'NORTH DISTRICT', 431: 'NORTH GARO HILLS', 432: 'NORTH GOA', 433: 'NORTH TRIPURA', 434: 'NUAPADA', 435: 'OSMANABAD', 436: 'PAKUR', 437: 'PALAKKAD', 438: 'PALAMU', 439: 'PALGHAR', 440: 'PALI', 441: 'PALWAL', 442: 'PANCH MAHALS', 443: 'PANCHKULA', 444: 'PANIPAT', 445: 'PANNA', 446: 'PAPUM PARE', 447: 'PARBHANI', 448: 'PASHCHIM CHAMPARAN', 449: 'PATAN', 450: 'PATHANAMTHITTA', 451: 'PATHANKOT', 452: 'PATIALA', 453: 'PATNA', 454: 'PAURI GARHWAL', 455: 'PERAMBALUR', 456: 'PEREN', 457: 'PHEK', 458: 'PILIBHIT', 459: 'PITHORAGARH', 460: 'PONDICHERRY', 461: 'POONCH', 462: 'PORBANDAR', 463: 'PRAKASAM', 464: 'PRATAPGARH', 465: 'PUDUKKOTTAI', 466: 'PULWAMA', 467: 'PUNE', 468: 'PURBI CHAMPARAN', 469: 'PURI', 470: 'PURNIA', 471: 'PURULIA', 472: 'RAE BARELI', 473: 'RAICHUR', 474: 'RAIGAD', 475: 'RAIGARH', 476: 'RAIPUR', 477: 'RAISEN', 478: 'RAJAURI', 479: 'RAJGARH', 480: 'RAJKOT', 481: 'RAJNANDGAON', 482: 'RAJSAMAND', 483: 'RAMANAGARA', 484: 'RAMANATHAPURAM', 485: 'RAMBAN', 486: 'RAMGARH', 487: 'RAMPUR', 488: 'RANCHI', 489: 'RANGAREDDI', 490: 'RATLAM', 491: 'RATNAGIRI', 492: 'RAYAGADA', 493: 'REASI', 494: 'REWA', 495: 'REWARI', 496: 'RI BHOI', 497: 'ROHTAK', 498: 'ROHTAS', 499: 'RUDRA PRAYAG', 500: 'RUPNAGAR', 501: 'S.A.S NAGAR', 502: 'SABAR KANTHA', 503: 'SAGAR', 504: 'SAHARANPUR', 505: 'SAHARSA', 506: 'SAHEBGANJ', 507: 'SAIHA', 508: 'SALEM', 509: 'SAMASTIPUR', 510: 'SAMBA', 511: 'SAMBALPUR', 512: 'SAMBHAL', 513: 'SANGLI', 514: 'SANGRUR', 515: 'SANT KABEER NAGAR', 516: 'SANT RAVIDAS NAGAR', 517: 'SARAIKELA KHARSAWAN', 518: 'SARAN', 519: 'SATARA', 520: 'SATNA', 521: 'SAWAI MADHOPUR', 522: 'SEHORE', 523: 'SENAPATI', 524: 'SEONI', 525: 'SEPAHIJALA', 526: 'SERCHHIP', 527: 'SHAHDOL', 528: 'SHAHJAHANPUR', 529: 'SHAJAPUR', 530: 'SHAMLI', 531: 'SHEIKHPURA', 532: 'SHEOHAR', 533: 'SHEOPUR', 534: 'SHIMLA', 535: 'SHIMOGA', 536: 'SHIVPURI', 537: 'SHOPIAN', 538: 'SHRAVASTI', 539: 'SIDDHARTH NAGAR', 540: 'SIDHI', 541: 'SIKAR', 542: 'SIMDEGA', 543: 'SINDHUDURG', 544: 'SINGRAULI', 545: 'SIRMAUR', 546: 'SIROHI', 547: 'SIRSA', 548: 'SITAMARHI', 549: 'SITAPUR', 550: 'SIVAGANGA', 551: 'SIVASAGAR', 552: 'SIWAN', 553: 'SOLAN', 554: 'SOLAPUR', 555: 'SONBHADRA', 556: 'SONEPUR', 557: 'SONIPAT', 558: 'SONITPUR', 559: 'SOUTH ANDAMANS', 560: 'SOUTH DISTRICT', 561: 'SOUTH GARO HILLS', 562: 'SOUTH GOA', 563: 'SOUTH TRIPURA', 564: 'SOUTH WEST GARO HILLS', 565: 'SOUTH WEST KHASI HILLS', 566: 'SPSR NELLORE', 567: 'SRIKAKULAM', 568: 'SRINAGAR', 569: 'SUKMA', 570: 'SULTANPUR', 571: 'SUNDARGARH', 572: 'SUPAUL', 573: 'SURAJPUR', 574: 'SURAT', 575: 'SURENDRANAGAR', 576: 'SURGUJA', 577: 'TAMENGLONG', 578: 'TAPI', 579: 'TARN TARAN', 580: 'TAWANG', 581: 'TEHRI GARHWAL', 582: 'THANE', 583: 'THANJAVUR', 584: 'THE NILGIRIS', 585: 'THENI', 586: 'THIRUVALLUR', 587: 'THIRUVANANTHAPURAM', 588: 'THIRUVARUR', 589: 'THOUBAL', 590: 'THRISSUR', 591: 'TIKAMGARH', 592: 'TINSUKIA', 593: 'TIRAP', 594: 'TIRUCHIRAPPALLI', 595: 'TIRUNELVELI', 596: 'TIRUPPUR', 597: 'TIRUVANNAMALAI', 598: 'TONK', 599: 'TUENSANG', 600: 'TUMKUR', 601: 'TUTICORIN', 602: 'UDAIPUR', 603: 'UDALGURI', 604: 'UDAM SINGH NAGAR', 605: 'UDHAMPUR', 606: 'UDUPI', 607: 'UJJAIN', 608: 'UKHRUL', 609: 'UMARIA', 610: 'UNA', 611: 'UNAKOTI', 612: 'UNNAO', 613: 'UPPER SIANG', 614: 'UPPER SUBANSIRI', 615: 'UTTAR KANNAD', 616: 'UTTAR KASHI', 617: 'VADODARA', 618: 'VAISHALI', 619: 'VALSAD', 620: 'VARANASI', 621: 'VELLORE', 622: 'VIDISHA', 623: 'VILLUPURAM', 624: 'VIRUDHUNAGAR', 625: 'VISAKHAPATANAM', 626: 'VIZIANAGARAM', 627: 'WARANGAL', 628: 'WARDHA', 629: 'WASHIM', 630: 'WAYANAD', 631: 'WEST DISTRICT', 632: 'WEST GARO HILLS', 633: 'WEST GODAVARI', 634: 'WEST JAINTIA HILLS', 635: 'WEST KAMENG', 636: 'WEST KHASI HILLS', 637: 'WEST SIANG', 638: 'WEST SINGHBHUM', 639: 'WEST TRIPURA', 640: 'WOKHA', 641: 'YADGIR', 642: 'YAMUNANAGAR', 643: 'YANAM', 644: 'YAVATMAL', 645: 'ZUNHEBOTO'}

CROP_MAPPING =  {0: 'Apple', 1: 'Arcanut (Processed)', 2: 'Arecanut', 3: 'Arhar/Tur', 4: 'Ash Gourd', 5: 'Atcanut (Raw)', 6: 'Bajra', 7: 'Banana', 8: 'Barley', 9: 'Bean', 10: 'Beans & Mutter(Vegetable)', 11: 'Beet Root', 12: 'Ber', 13: 'Bhindi', 14: 'Bitter Gourd', 15: 'Black pepper', 16: 'Blackgram', 17: 'Bottle Gourd', 18: 'Brinjal', 19: 'Cabbage', 20: 'Cardamom', 21: 'Carrot', 22: 'Cashewnut', 23: 'Cashewnut Processed', 24: 'Cashewnut Raw', 25: 'Castor seed', 26: 'Cauliflower', 27: 'Citrus Fruit', 28: 'Coconut ', 29: 'Coffee', 30: 'Colocosia', 31: 'Cond-spcs other', 32: 'Coriander', 33: 'Cotton(lint)', 34: 'Cowpea(Lobia)', 35: 'Cucumber', 36: 'Drum Stick', 37: 'Dry chillies', 38: 'Dry ginger', 39: 'Garlic', 40: 'Ginger', 41: 'Gram', 42: 'Grapes', 43: 'Groundnut', 44: 'Guar seed', 45: 'Horse-gram', 46: 'Jack Fruit', 47: 'Jobster', 48: 'Jowar', 49: 'Jute', 50: 'Jute & mesta', 51: 'Kapas', 52: 'Khesari', 53: 'Korra', 54: 'Lab-Lab', 55: 'Lemon', 56: 'Lentil', 57: 'Linseed', 58: 'Litchi', 59: 'Maize', 60: 'Mango', 61: 'Masoor', 62: 'Mesta', 63: 'Moong(Green Gram)', 64: 'Moth', 65: 'Niger seed', 66: 'Oilseeds total', 67: 'Onion', 68: 'Orange', 69: 'Other  Rabi pulses', 70: 'Other Cereals & Millets', 71: 'Other Citrus Fruit', 72: 'Other Dry Fruit', 73: 'Other Fresh Fruits', 74: 'Other Kharif pulses', 75: 'Other Vegetables', 76: 'Paddy', 77: 'Papaya', 78: 'Peach', 79: 'Pear', 80: 'Peas  (vegetable)', 81: 'Peas & beans (Pulses)', 82: 'Perilla', 83: 'Pineapple', 84: 'Plums', 85: 'Pome Fruit', 86: 'Pome Granet', 87: 'Potato', 88: 'Pulses total', 89: 'Pump Kin', 90: 'Ragi', 91: 'Rajmash Kholar', 92: 'Rapeseed &Mustard', 93: 'Redish', 94: 'Ribed Guard', 95: 'Rice', 96: 'Ricebean (nagadal)', 97: 'Rubber', 98: 'Safflower', 99: 'Samai', 100: 'Sannhamp', 101: 'Sapota', 102: 'Sesamum', 103: 'Small millets', 104: 'Snak Guard', 105: 'Soyabean', 106: 'Sugarcane', 107: 'Sunflower', 108: 'Sweet potato', 109: 'Tapioca', 110: 'Tea', 111: 'Tobacco', 112: 'Tomato', 113: 'Total foodgrain', 114: 'Turmeric', 115: 'Turnip', 116: 'Urad', 117: 'Varagu', 118: 'Water Melon', 119: 'Wheat', 120: 'Yam', 121: 'other fibres', 122: 'other misc. pulses', 123: 'other oilseeds'}

REVERSED_STATE_MAPPING = {v.strip().lower(): k for k, v in STATE_MAPPING.items()}
REVERSED_DISTRICT_MAPPING = {v.strip().lower(): k for k, v in DISTRICT_MAPPING.items()}
REVERSED_CROP_MAPPING = {v.strip().lower(): k for k, v in CROP_MAPPING.items()}


def yeild_recommend(request):
    if request.method == "POST":
        try:
            # Extract form data
            state_name = str(request.POST.get("state_name").strip().lower())
            district_name = str(request.POST.get("district_name").strip().lower())
            crop_year = int(request.POST.get("crop_year"))
            season = int(request.POST.get("season"))
            crop = str(request.POST.get("crop").strip().lower())
            area = float(request.POST.get("area"))
            print(state_name, district_name, crop_year, season, crop, area)

            # Map names to integers
            state_id = REVERSED_STATE_MAPPING.get(state_name, -1)
            district_id = REVERSED_DISTRICT_MAPPING.get(district_name, -1)
            crop_id = REVERSED_CROP_MAPPING.get(crop, -1)
            print(state_id, district_id, crop_id)

            # Handle mapping errors
            if -1 in [state_id, district_id, crop_id]:
                return JsonResponse({"error": "Invalid state, district, or crop name."}, status=400)
            input =[state_id, district_id, crop_year, season, crop_id, area]
            print(input)
            model = joblib.load(r'path/to/your/model.pkl')
            predict = model.predict(np.array(input).reshape(1, -1))

        
            return JsonResponse({'recommended_production': predict[0]})
        except Exception as e:
            # Log the error and return a 400 response with error details
            logging.error(f"Error yeild_recommend: {e}")
            return JsonResponse({'error': str(e)}, status=400)


    return render(request, 'crop_yeild/crop_yeild.html')
